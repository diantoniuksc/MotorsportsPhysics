@page "/apex"
@using Microsoft.JSInterop
@using Microsoft.AspNetCore.Components.Web
@inject IJSRuntime JS

<PageTitle>Apex Physics - Race &amp; Learn</PageTitle>

<div class="relative flex min-h-screen w-full flex-col">
  <header class="sticky top-0 z-20 w-full bg-background-light/80 backdrop-blur-sm">
    <div class="container mx-auto flex items-center justify-between whitespace-nowrap border-b border-primary/20 px-4 sm:px-6 lg:px-8 py-3">
      <div class="flex items-center gap-4 text-gray-800">
        <svg class="h-6 w-6 text-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M12.0799 24L4 19.2479L9.95537 8.75216L18.04 13.4961L18.0446 4H29.9554L29.96 13.4961L38.0446 8.75216L44 19.2479L35.92 24L44 28.7521L38.0446 39.2479L29.96 34.5039L29.9554 44H18.0446L18.04 34.5039L9.95537 39.2479L4 28.7521L12.0799 24Z" />
        </svg>
        <h1 class="text-xl font-bold tracking-tight">Apex Physics</h1>
      </div>
      <nav class="hidden md:flex items-center gap-8">
        <a class="text-sm font-medium hover:text-primary transition-colors" href="#">Race</a>
        <a class="text-sm font-medium hover:text-primary transition-colors" href="#">Learn</a>
        <a class="text-sm font-medium hover:text-primary transition-colors" href="#">Community</a>
      </nav>
      <div class="flex items-center gap-4">
        <button class="flex items-center justify-center rounded-full h-10 w-10 bg-primary/20 hover:bg-primary/30 transition-colors">
          <svg fill="currentColor" height="20" viewBox="0 0 256 256" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"/></svg>
        </button>
        <div class="h-10 w-10 rounded-full bg-cover bg-center" style='background-image:url("images/car.png")'></div>
      </div>
    </div>
  </header>

  <!-- Hero video area replaced with our animated SVG over the track image -->
  <main class="container mx-auto flex-1 px-4 sm:px-6 lg:px-8 py-8">
    <div class="relative w-full aspect-[16/9] rounded-lg overflow-hidden shadow-lg mb-8">
      <div class="absolute inset-0">
        <svg @ref="svg" viewBox="0 0 847 565" class="w-full h-full">
          <image href="images/track.png" x="0" y="0" width="847" height="565" preserveAspectRatio="none"/>
          <path id="racePath" d="@pathD" fill="none" stroke="#00bcd4" stroke-width="0" />
          <image id="carSprite" href="images/car.png" width="70" height="40" x="420" y="500"/>
        </svg>
      </div>
      <div class="absolute inset-0 pointer-events-none bg-gradient-to-t from-black/40 to-transparent"></div>
      <div class="absolute bottom-0 left-0 p-6 text-white">
        <h2 class="text-3xl sm:text-4xl font-bold">Cornering Dynamics</h2>
      </div>
    </div>

    <!-- Sample content section from design -->
  <div class="bg-background-light rounded-lg border border-primary/20 shadow-lg p-6">
      <div class="flex flex-col md:flex-row md:items-start gap-6">
        <div class="flex-1">
          <p class="text-primary font-bold text-sm mb-1">Question 3/5</p>
          <p class="text-lg font-bold text-gray-800">What happens to the car's weight distribution during a high-speed corner?</p>
        </div>
        <div class="w-full md:w-1/2 space-y-3">
          <label class="flex items-center gap-4 rounded-lg border border-primary/20 p-4 hover:bg-primary/10 cursor-pointer transition-all">
            <input type="radio" name="wd" class="h-5 w-5" />
            <span class="text-sm font-medium">Shifts forward, increasing front grip</span>
          </label>
          <label class="flex items-center gap-4 rounded-lg border border-primary/20 p-4 hover:bg-primary/10 cursor-pointer transition-all">
            <input type="radio" name="wd" class="h-5 w-5" />
            <span class="text-sm font-medium">Shifts backward, increasing rear grip</span>
          </label>
          <label class="flex items-center gap-4 rounded-lg border border-primary/20 p-4 hover:bg-primary/10 cursor-pointer transition-all">
            <input type="radio" name="wd" class="h-5 w-5" />
            <span class="text-sm font-medium">Remains balanced</span>
          </label>
          <label class="flex items-center gap-4 rounded-lg border border-primary/20 p-4 hover:bg-primary/10 cursor-pointer transition-all">
            <input type="radio" name="wd" class="h-5 w-5" />
            <span class="text-sm font-medium">Shifts laterally, affecting tire load</span>
          </label>
        </div>
      </div>
      <div class="flex justify-center mt-6">
        <button class="w-full md:w-auto flex min-w-[120px] items-center justify-center rounded-lg h-11 px-6 bg-primary text-white text-sm font-bold tracking-wider hover:bg-opacity-90 transition-all">
          <span>Submit Answer</span>
        </button>
      </div>
    </div>
  </main>
</div>

@code {
  private ElementReference svg;
  private IJSObjectReference? _module;
  private IJSObjectReference? _anim;
  private int speed = 140;

  private string pathD =
    "M455.112 404C333.824 407.368 265.469 406.69 142.612 404C115.491 398.004 101.551 397.363 69.6119 381C62.688 378.119 54.6375 371.913 33.6119 353.5C7.24282 331.35 -0.023026 321.235 1.11189 307.5C2.21865 289.658 11.0689 282.31 54.1119 278C79.1942 278.992 93.3286 280.719 118.612 285L209.112 311.5C229.419 314.692 240.805 314.274 261.112 311.5C273.841 310.165 280.658 306.393 292.112 293C295.614 277.182 297.085 267.516 298.612 248.5C300.122 235.579 299.325 228.557 287.112 217.5C270.084 204.075 255.34 196.285 224.612 181.5L183.112 146.5C166.185 125.936 162.553 114.069 163.112 92.5C164.252 69.8158 167.742 57.6963 183.112 38C182.363 35.6948 212.43 15.1863 241.612 9.5C259.823 4.30919 272.176 2.04574 304.112 1C330.611 2.41292 344.747 3.75889 365.612 9.5C386.183 13.6806 395.456 18.9656 404.612 38C415.557 62.7294 420.546 77.4774 424.612 107.5L431.112 181.5C434.835 197.277 438.484 205.648 455.112 217.5C468.251 224.432 476.236 227.188 491.612 230L566.612 236C582.647 238.514 591.335 240.812 605.612 248.5C614.771 258.635 619.564 264.223 625.612 273.5C630.794 285.534 633.266 292.501 632.612 307.5C627.609 328.421 623.676 339.866 611.612 359C601.945 370.303 594.969 374.91 580.612 381C534.536 394.026 506.872 398.807 455.112 404Z";

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    if (!firstRender) return;
    _module = await JS.InvokeAsync<IJSObjectReference>("import", "/js/trackSim.js");
    _anim = await _module.InvokeAsync<IJSObjectReference>("init", svg, new { speed, startRotation = 50, angleSmoothing = 0.18 });
    await _anim.InvokeVoidAsync("play");
  }
}
